%% Read from files %%
files = dir('cleared/*.L.csv');

FolderName = 'cleared/';

MyReturnsMap = containers.Map();
MyDatesMap = containers.Map();

N = length(files);

files(1)

% Fill Returns and Dates Map
for i=1:N
    FileName = files(i).name;
    [Dates, Returns] = readStock(strcat(FolderName,FileName));
    MyReturnsMap(FileName)= Returns;
    MyDatesMap(FileName)= Dates;
end

% Get Dates and Returns for FTSE Index
% [Dates,Returns] = indexTracker(MyDatesMap, MyReturnsMap, files);
[DatesFTSE, ReturnsFTSE] = readStock('cleared/FTSE.csv')

%% Greedy Forward Selection %%
%Greedy Forward Selection of 6 assets
GreedyMap = greedySelection(Returns, MyReturnsMap, files);
BestSix = containers.Map();
for i=1:6
    SmallestDifference = 99999;
    SmallestRef = '';
    k = keys(GreedyMap);
    for j = k
        FileName = j{1};
        Difference = GreedyMap(FileName);
        Mean = mean(Difference);
        if Mean < SmallestDifference
            SmallestDifference = Mean;
            SmallestRef = FileName;
        end
    end
    
    BestSix(SmallestRef) = SmallestDifference;
    remove(GreedyMap,SmallestRef);
end

MeanSquareList = zeros(6,1);

sumFTSE = cumulativeSum(ReturnsFTSE);

sumGreedy = zeros(758, 6);

for i = keys(BestSix)
   FileName = i{1}
   sumGreedy(:,i) = cumulativeSum(MyReturnsMap(FileName));
end


hold on
plot(Dates,sumFTSE, 'DisplayName','FTSE30');

count = 1;
for i=keys(BestSix)
    FileName = i{1}
    sumArray = cumulativeSum(MyReturnsMap(FileName));
    plot(MyDatesMap(FileName), sumArray, 'DisplayName',FileName);
    MeanSquareList(count) = immse(MyReturnsMap(FileName), ReturnsFTSE)
    count = count +1;
end
plot(Dates, sparseSum, 'DisplayName', 'Sparse')
legend('Location','southeast')
title('Index Tracking - Greedy Forward Selection')

hold off

MeanSquareGreedy = mean(MeanSquareList);